<!--
Copyright 2022 Carnegie Mellon University. All Rights Reserved.
Released under a MIT (SEI)-style license. See LICENSE.md in the project root for license information.
-->

<div class="app-header-container background text" autosize>
  <div class="archive">
    <div class="max-width">
      <div class="top-row">
        <div class="search-cell two-cell">
          <mat-icon
            style="transform: scale(0.75); margin-right: 5px;"
            class="icon-color"
            svgIcon="ic_magnify_search"
          ></mat-icon>
          <mat-form-field>
            <input matInput placeholder="Search the Archive" class="tiny" [formControl]="filterControl" />
          </mat-form-field>
          <mat-icon class="mdi-24px point" fontIcon="mdi-close-circle-outline" (click)="applyFilter('')"></mat-icon>
        </div>
        <div class="seven-cell">
          <mat-form-field>
            <mat-select [(ngModel)]="cardId" (selectionChange)="sortChanged(sort)">
              <mat-option [value]="'all'">All Cards</mat-option>
              <mat-option *ngFor="let card of showCardList" [value]="card.id">
                {{card.name}}
              </mat-option>
            </mat-select>
          </mat-form-field>
          <button
            mat-button
            *ngIf="canAddArticles()"
            (click)="addOrEditArticle(null)"
            style="outline: none;"
            title="Add an Article"
          >
            <mat-icon class="add-button" fontIcon="mdi-plus-circle"></mat-icon> Add Article
          </button>
        </div>
        <div class="seven-cell">
          <button mat-stroked-button class="tiny" (click)="filterBySourceType('Intel')" *ngIf="sourceType !== 'Intel'">
            <mat-icon fontIcon="{{ sourceIcon['Intel'] }}" class="mdi-18px"></mat-icon>
            Intel
          </button>
          <button mat-flat-button class="tiny" (click)="filterBySourceType('Intel')" *ngIf="sourceType === 'Intel'">
            <mat-icon fontIcon="{{ sourceIcon['Intel'] }}" class="mdi-18px"></mat-icon>
            Intel
          </button>
          <button mat-stroked-button class="tiny" (click)="filterBySourceType('Reporting')" *ngIf="sourceType !== 'Reporting'">
            <mat-icon fontIcon="{{ sourceIcon['Reporting'] }}" class="mdi-18px"></mat-icon>
            Reporting
          </button>
          <button mat-flat-button class="tiny" (click)="filterBySourceType('Reporting')" *ngIf="sourceType === 'Reporting'">
            <mat-icon fontIcon="{{ sourceIcon['Reporting'] }}" class="mdi-18px"></mat-icon>
            Reporting
          </button>
          <button mat-stroked-button class="tiny" (click)="filterBySourceType('News')" *ngIf="sourceType !== 'News'">
            <mat-icon fontIcon="{{ sourceIcon['News'] }}" class="mdi-18px"></mat-icon>
            News
          </button>
          <button mat-flat-button class="tiny" (click)="filterBySourceType('News')" *ngIf="sourceType === 'News'">
            <mat-icon fontIcon="{{ sourceIcon['News'] }}" class="mdi-18px"></mat-icon>
            News
          </button>
          <button mat-stroked-button class="tiny" (click)="filterBySourceType('Social')" *ngIf="sourceType !== 'Social'">
            <mat-icon fontIcon="{{ sourceIcon['Social'] }}" class="mdi-18px"></mat-icon>
            Social
          </button>
          <button mat-flat-button class="tiny" (click)="filterBySourceType('Social')" *ngIf="sourceType === 'Social'">
            <mat-icon fontIcon="{{ sourceIcon['Social'] }}" class="mdi-18px"></mat-icon>
            Social
          </button>
        </div>
        <div class="two-cell last-cell">
          <button
            mat-icon-button
            (click)="gotoWallSection()"
            style="outline: none;"
            title="Wall"
          >
            <mat-icon class="mdi-24px self-center" fontIcon="mdi-wall"></mat-icon>
          </button>
          <button
            mat-icon-button
            *ngIf="showAdminButton"
            (click)="gotoAdmin()"
            style="outline: none;"
            title="Administration"
          >
            <mat-icon class="mdi-24px self-center" fontIcon="mdi-cog"></mat-icon>
          </button>
        </div>
      </div>
    </div>
  </div>
  <section class="cards">
    <mat-card class="card" *ngFor="let userArticle of filteredUserArticleList">
      <mat-card-header [ngClass]="getIsReadClass(userArticle)">
        <div mat-card-avatar>
          <mat-icon style="overflow:visible" fontIcon="{{ sourceIcon[userArticle.article.sourceType] }}" title="{{ userArticle.article.sourceType }}" class="mdi-48px center-self title source-icon"></mat-icon>
        </div>
        <mat-card-title class="article-title">{{userArticle.article.name}}</mat-card-title>
        <mat-card-subtitle class="article-subtitle">{{userArticle.article.sourceName}}</mat-card-subtitle>
      </mat-card-header>
        <mat-card-content class="article-text" contenteditable="false">
          <quill-view-html [content]="userArticle.article.description" theme="snow"></quill-view-html>
          <div class="center">
            <span style="float: left;"><mat-icon fontIcon="mdi-calendar-clock-outline" alt="Simulated Date/Time"></mat-icon> {{ userArticle.article.datePosted.toLocaleString('en-US', {timeZone: 'America/New_York'}) | date:'short' }} ET</span>
          </div>
          <!--<span style="float: right;"><mat-icon fontIcon="mdi-progress-clock" alt="Actual Date/Time"></mat-icon> {{ userArticle.actualDatePosted | date:"MM/dd HH:mm" }}</span>-->
        </mat-card-content>
      <mat-card-actions class="action-buttons">
        <button mat-button class="article-action" title="Read/Unread" (click)="toggleReadStatus(userArticle)" *ngIf="!userArticle.isRead">
          <mat-icon style="margin-bottom: 12px;" fontIcon="mdi-checkbox-blank-outline" alt="UserArticle Read"></mat-icon> Read
        </button>
        <button mat-button class="article-action" title="Read/Unread" (click)="toggleReadStatus(userArticle)" *ngIf="userArticle.isRead">
          <mat-icon style="margin-bottom: 12px;" fontIcon="mdi-checkbox-marked-outline" alt="UserArticle Read"></mat-icon> Read
        </button>
        <button mat-button class="article-action" title="Share UserArticle" (click)="openShareDialog(userArticle)">
          <mat-icon style="margin-bottom: 12px;" fontIcon="mdi-share-variant" alt="Share UserArticle"></mat-icon> Share
        </button>
        <button mat-button class="article-action" title="More Article Info" (click)="openMoreDialog(userArticle)" [disabled]="!userArticle.article.url">
          <mat-icon style="margin-bottom: 12px;" fontIcon="mdi-eye" alt="View Media"></mat-icon> More
        </button>
        <br />
        <button
          mat-button
          class="article-action"
          (click)="addOrEditArticle(userArticle.article); $event.stopPropagation()"
          style="outline: none;"
          title="Edit {{ userArticle.article.name }}"
          *ngIf="userArticle.article.exhibitId && userArticle.article.sourceName === myTeam.shortName"
        >
          <mat-icon style="margin-bottom: 12px;" fontIcon="mdi-square-edit-outline"></mat-icon> Edit
        </button>
        <button
          mat-button
          class="article-action"
          (click)="deleteArticle(userArticle.article); $event.stopPropagation()"
          style="outline: none;"
          title="Delete {{ userArticle.article.name }}"
          *ngIf="userArticle.article.exhibitId && userArticle.article.sourceName === myTeam.shortName"
        >
          <mat-icon style="margin-bottom: 12px;" fontIcon="mdi-trash-can"></mat-icon> Delete
        </button>
      </mat-card-actions>
    </mat-card>
  </section>
  <mat-card
    *ngIf="isLoading"
    style="display: flex; justify-content: center; align-items: center;"
  >
    <mat-progress-spinner color="primary" mode="indeterminate">
    </mat-progress-spinner>
  </mat-card>
</div>
