<!--
Copyright 2022 Carnegie Mellon University. All Rights Reserved.
Released under a MIT (SEI)-style license. See LICENSE.md in the project root for license information.
-->

<div class="cssLayoutRowStartCenter">
  <div class="sp-icon">
    <mat-icon
      class="mdi-24px"
      fontIcon="mdi-monitor-dashboard"
      [ngStyle]="{'color': topbarColor}"
    ></mat-icon>
  </div>
  <mat-form-field class="button-margins">
    <mat-label>Collection</mat-label>
    <mat-select placeholder="Collection" [value]="selectedCollectionId" (selectionChange)="selectCollection($event.value)">
      <mat-option *ngFor="let collection of collectionList" [value]="collection.id">
        {{ collection.name }}
      </mat-option>
    </mat-select>
  </mat-form-field>
  <div class="button-margins" *ngIf="selectedCollectionId">
    <span>
      <button mat-stroked-button (click)="addOrEditExhibit(null)">Add Exhibit</button>
    </span>
  </div>
  <div *ngIf="selectedCollectionId">
    <mat-paginator
      #paginator
      [length]="exhibitList?.length"
      [pageIndex]="pageIndex"
      [pageSize]="pageSize"
      [pageSizeOptions]="[5, 10, 15, 20, 25, 50, 100, 200]"
      (page)="paginatorEvent($event)"
    ></mat-paginator>
  </div>
</div>

<mat-accordion displayMode="flat">
  <section
    matSort
    (matSortChange)="sortChanged($event)"
    class="mat-elevation-z2 mat-header-row"
  >
    <span class="mat-header-cell three-cell" mat-sort-header="dateCreated">Date Created</span>
    <span class="mat-header-cell three-cell" mat-sort-header="createdBy">User</span>
    <span class="mat-header-cell two-cell" mat-sort-header="scenarioId">Scenario ID</span>
    <span class="mat-header-cell one-cell" mat-sort-header="currentMove">Current Move</span>
    <span class="mat-header-cell one-cell" mat-sort-header="currentInject">Current Inject</span>
  </section>

  <mat-expansion-panel
    *ngFor="let exhibit of paginateExhibits(exhibitList, pageIndex, pageSize)"
    [expanded]="editExhibit.id === exhibit.id"
  >
    <mat-expansion-panel-header class="mat-row" *ngIf="!isLoading" (click)="togglePanel(exhibit); $event.stopPropagation()">
      <span class="mat-cell three-cell">
        <button
          mat-icon-button
          (click)="addOrEditExhibit(exhibit); $event.stopPropagation()"
          style="outline: none;"
          title="Edit Exhibit"
        >
          <mat-icon class="mdi-24px center-self" fontIcon="mdi-square-edit-outline"></mat-icon>
        </button>
        <button
          mat-icon-button
          (click)="deleteExhibit(exhibit); $event.stopPropagation()"
          style="outline: none;"
          title="Delete Exhibit"
        >
          <mat-icon class="mdi-24px center-self" fontIcon="mdi-trash-can"></mat-icon>
        </button>
        {{ exhibit.dateCreated | date: "yyyy-MM-dd HH:mm" }}
      </span>
      <span class="mat-cell three-cell center-self">
        {{ getUserName(exhibit.createdBy) }}
      </span>
      <span class="mat-cell three-cell center-self">
        {{ exhibit.scenarioId }}
      </span>
      <span class="mat-cell one-cell center-self">
        {{ exhibit.currentMove }}
      </span>
      <span class="mat-cell one-cell center-self">
        {{ exhibit.currentInject }}
      </span>
    </mat-expansion-panel-header>
    <div class="panel-container" *ngIf="editExhibit.id === exhibit.id">
      <div class="team-div">
        <h3>Teams</h3>
        <button
          class="center-self"
          mat-icon-button
          (click)="showTeams = !showTeams; $event.stopPropagation()"
          style="outline: none;"
          title="Show/Hide Teams"
        >
          <mat-icon class="mdi-24px center-self" fontIcon="mdi-chevron-down" *ngIf="!showTeams"></mat-icon>
          <mat-icon class="mdi-24px center-self" fontIcon="mdi-chevron-up" *ngIf="showTeams"></mat-icon>
        </button>
      </div>
      <app-admin-exhibit-teams
        *ngIf="showTeams"
        [exhibitId]="exhibit.id"
        [teamList]="teamList"
        class="full-width"
      ></app-admin-exhibit-teams>
      <div class="team-div">
        <h3>Articles</h3>
        <button
          class="center-self"
          mat-icon-button
          (click)="showArticles = !showArticles; $event.stopPropagation()"
          style="outline: none;"
          title="Show/Hide Articles"
        >
          <mat-icon class="mdi-24px center-self" fontIcon="mdi-chevron-down" *ngIf="!showArticles"></mat-icon>
          <mat-icon class="mdi-24px center-self" fontIcon="mdi-chevron-up" *ngIf="showArticles"></mat-icon>
        </button>
      </div>
      <app-admin-exhibit-articles
        *ngIf="showArticles"
        [exhibit]="exhibit"
        [teamList]="teamList"
        class="full-width"
      >
      </app-admin-exhibit-articles>
    </div>
  </mat-expansion-panel>
</mat-accordion>

<mat-card
  *ngIf="isLoading"
  style="display: flex; justify-content: center; align-items: center;"
>
  <mat-progress-spinner color="primary" mode="indeterminate">
  </mat-progress-spinner>
</mat-card>
